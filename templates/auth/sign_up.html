<!DOCTYPE html>
<html lang="ko">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>회원 가입</title>
      <script src="https://cdn.tailwindcss.com"></script>
      <script defer src="/static/js/sdk/auth.js"></script>
      <link rel="stylesheet" href="{{url_for('static', filename = 'css/font.css')}}" />
      <link rel="stylesheet" href="{{url_for('static', filename = 'css/xp_style.css')}}" />
   </head>
   <div class="window">
       <div class="window-header">
          <h1 class="text-3xl" style="font-family:Pretendard-Regular;">회원 가입</h1>
          <div class="close-btn" onclick="window.close()">✕</div>
       </div>
       <div class="window-body">
           <form id="sign_in_form" action="">
              <div>
                 <label
                    for="user_id"
                    class="text-xl text-base font-medium text-gray-900 mb-2"style="font-family:Pretendard-Regular"
                    >아이디</label
                    >
                 <div class="flex items-center gap-2">
                    <input
                       required
                       minlength="1"
                       type="text"
                       id="user_id"
                       name="user_id"
                       placeholder="아이디를 입력해주세요"
                       class="flex-1 w-full px-5 py-2 rounded-2xl bg-gray-100 focus:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 text-lg"style="font-family:Pretendard-Regular"
                       />
                    <button
                       id="duplicated_btn"
                       type="button"
                       class="px-4 py-3 bg-gray-200 rounded-2xl text-gray-800 text-base font-medium hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400"style="font-family:Pretendard-Regular"
                       >
                    중복 확인
                    </button>
                 </div>
              </div>
              <div class="mt-3">
                 <label
                    for="password"
                    class="text-xl block text-base font-medium text-gray-900 mb-2"style="font-family:Pretendard-Regular"
                    >비밀번호</label
                    >
                 <input
                    required
                    minlength="1"
                    type="password"
                    id="password"
                    name="password"
                    placeholder="비밀번호를 입력해주세요"
                    class="w-full px-5 py-2 rounded-2xl bg-gray-100 focus:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 text-lg"style="font-family:Pretendard-Regular"
                    />
              </div>
              <div class="mt-3">
                 <label
                    for="password_confirm"
                    class="text-xl block text-base font-medium text-gray-900 mb-2"style="font-family:Pretendard-Regular"
                    >비밀번호 확인</label
                    >
                 <input
                    required
                    minlength="1"
                    type="password"
                    id="password_confirm"
                    name="password_confirm"
                    placeholder="비밀번호를 다시 입력해주세요"
                    class="w-full px-5 py-2 rounded-2xl bg-gray-100 focus:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 text-lg"style="font-family:Pretendard-Regular"
                    />
              </div>
              <div class="mt-3">
                 <label
                    for="nickname"
                    class="text-xl block text-base font-medium text-gray-900 mb-2"style="font-family:Pretendard-Regular"
                    >닉네임</label
                    >
                 <input
                    required
                    minlength="1"
                    type="text"
                    id="nickname"
                    name="nickname"
                    placeholder="닉네임을 입력해주세요"
                    class="w-full px-5 py-2 rounded-2xl bg-gray-100 focus:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 text-lg"style="font-family:Pretendard-Regular"
                    />
              </div>
              <div class="mt-5">
                 <button
                    id="sign_up_btn"
                    class="xp-button w-full mt-4"
                    type="button"
                    >
                 가입하기
                 </button>
              </div>
          </form>
       </div>
   </div>
   </body>
   <script>
      document
        .getElementById("duplicated_btn")
        ?.addEventListener("click", async (e) => {
          e.preventDefault();
          const user_id = document.getElementById("user_id").value;
          const res = await AuthHelper.check_duplicate(user_id);
          if (res.result.is_duplicated) {
            alert("이미 아이디가 있습니다. 다른 아이디를 사용해주세요");
            return;
          } else {
            alert("사용 가능한 아이디입니다.");
          }
        });

      document.getElementById("sign_up_btn").addEventListener("click", async function(e){

          const formDiv = document.getElementById("sign_in_form")
          const formData = new FormData(formDiv);
          if (formData.get("password_confirm") !== formData.get("password")) {
              e.preventDefault();
            alert("비밀번호랑 비밀번호 확인 값이 다릅니다.");
            return;
          }
          if (!this.reportValidity()) {
                e.preventDefault();
                return;
              }
          e.preventDefault();
          const res = await AuthHelper.sign_up(
            formData.get("user_id"),
            formData.get("password"),
            formData.get("nickname")
          );

          if (res.error) {
            alert(res.error);
          } else {
            alert("회원가입 성공");
            window.location.replace("{{ url_for('auth.page_sign_in') }}");

          }
        });
   </script>
</html>